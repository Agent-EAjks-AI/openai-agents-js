---
title: エージェントの実行結果
description: Learn how to access the results and output from your agent run
---

import { Code } from '@astrojs/starlight/components';
import handoffFinalOutputTypes from '../../../../../../examples/docs/results/handoffFinalOutputTypes.ts?raw';
import historyLoop from '../../../../../../examples/docs/results/historyLoop.ts?raw';

[エージェントの実行](/openai-agents-js/ja/guides/running-agents)を行うと、次のいずれかを受け取ります:

- `stream: true` なしで `run` を呼び出した場合は [`RunResult`](/openai-agents-js/openai/agents/classes/runresult)
- `stream: true` 付きで `run` を呼び出した場合は [`StreamedRunResult`](/openai-agents-js/openai/agents/classes/streamedrunresult)。ストリーミングの詳細は[ストリーミング](/openai-agents-js/ja/guides/streaming)も参照してください

## 最終出力

`finalOutput` プロパティには、最後に実行されたエージェントの最終出力が入ります。この実行結果は次のいずれかです:

- `string` — `outputType` が定義されていない任意のエージェントのデフォルト
- `unknown` — エージェントが出力タイプとして JSON スキーマを定義している場合。この場合 JSON はパースされていますが、型の検証は手動で行う必要があります
- `z.infer<outputType>` — エージェントが出力タイプとして Zod スキーマを定義している場合。出力は自動的にこのスキーマに対してパースされます
- `undefined` — エージェントが出力を生成しなかった場合（例: 出力を生成する前に停止した）

異なる出力タイプを持つハンドオフを使用している場合は、エージェントの作成に `new Agent()` コンストラクタではなく `Agent.create()` メソッドを使用してください。

これにより、SDK は発生しうるすべてのハンドオフにわたる出力タイプを推論し、`finalOutput` プロパティに対してユニオン型を提供できます。

例:

<Code
  lang="typescript"
  code={handoffFinalOutputTypes}
  title="Handoff final output types"
/>

## 次ターンの入力

次のターンの入力へアクセスする方法は 2 つあります:

- `result.history` — あなたの入力とエージェントの出力の両方のコピーを含みます
- `result.output` — エージェント全体の実行の出力を含みます

`history` はチャットのようなユースケースで完全な履歴を維持するのに便利です:

<Code lang="typescript" code={historyLoop} title="History loop" />

## 最後のエージェント

`lastAgent` プロパティには、最後に実行されたエージェントが入ります。アプリケーションによっては、次回の ユーザー 入力に対してこれが有用なことがよくあります。たとえば、フロントラインのトリアージ エージェントが言語別エージェントへハンドオフする場合、最後のエージェントを保存して、次回 ユーザー がそのエージェントにメッセージを送るときに再利用できます。

ストリーミング モードでは、現在実行中のエージェントに対応する `currentAgent` プロパティへアクセスするのも有用です。

## 新規アイテム

`newItems` プロパティには、実行中に生成された新規アイテムが入ります。アイテムは [`RunItem`](/openai-agents-js/openai/agents/type-aliases/runitem) です。ランアイテムは LLM が生成した元アイテムをラップします。これにより、LLM の出力に加えて、これらのイベントがどのエージェントに関連付けられていたかにアクセスできます。

- [`RunMessageOutputItem`](/openai-agents-js/openai/agents/classes/runmessageoutputitem) は LLM からのメッセージを示します。元アイテムは生成されたメッセージです
- [`RunHandoffCallItem`](/openai-agents-js/openai/agents/classes/runhandoffcallitem) は LLM がハンドオフ ツールを呼び出したことを示します。元アイテムは LLM からのツール呼び出しアイテムです
- [`RunHandoffOutputItem`](/openai-agents-js/openai/agents/classes/runhandoffoutputitem) はハンドオフが発生したことを示します。元アイテムはハンドオフ ツール呼び出しへのツール応答です。アイテムからソース/ターゲットのエージェントにもアクセスできます
- [`RunToolCallItem`](/openai-agents-js/openai/agents/classes/runtoolcallitem) は LLM がツールを起動したことを示します
- [`RunToolCallOutputItem`](/openai-agents-js/openai/agents/classes/runtoolcalloutputitem) はツールが呼び出されたことを示します。元アイテムはツールの応答です。アイテムからツールの出力にもアクセスできます
- [`RunReasoningItem`](/openai-agents-js/openai/agents/classes/runreasoningitem) は LLM からの reasoning アイテムを示します。元アイテムは生成された reasoning です
- [`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem) は LLM がツール呼び出しの承認を要求したことを示します。元アイテムは LLM からのツール呼び出しアイテムです

## 状態

`state` プロパティには実行の状態が入ります。`result` に付随する情報の多くは `state` から派生しますが、`state` はシリアライズ/デシリアライズ可能で、エラーからの復旧が必要な場合や[`interruption`](#interruptions)への対応が必要な場合に、後続の `run` 呼び出しの入力としても使用できます。詳細は[エージェントの実行](/openai-agents-js/ja/guides/running-agents#exceptions)を参照してください。

## 割り込み

エージェントで `needsApproval` を使用している場合、続行する前に処理が必要な `interruptions` が `run` によってトリガーされることがあります。その場合、`interruptions` は割り込みの原因となった `ToolApprovalItem` の配列になります。割り込みへの対処方法の詳細は[人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop)を参照してください。

## その他の情報

### 元レスポンス

`rawResponses` プロパティには、エージェント実行中にモデルが生成した元の LLM レスポンスが入ります。

### 最後のレスポンス ID

`lastResponseId` プロパティには、エージェント実行中にモデルが生成した最後のレスポンスの ID が入ります。

### ガードレール実行結果

`inputGuardrailResults` と `outputGuardrailResults` プロパティには、存在する場合は ガードレール の実行結果が入ります。ガードレールの実行結果には、記録や保存に有用な情報が含まれることがあるため、利用できるようにしています。

### 元の入力

`input` プロパティには、run メソッドに提供した元の入力が入ります。多くの場合は不要ですが、必要な場合に備えて参照できます。
