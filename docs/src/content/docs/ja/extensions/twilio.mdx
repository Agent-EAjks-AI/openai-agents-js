---
title: Realtime Agent を Twilio に接続
description: Connect your Agents SDK agents to Twilio to use voice agents
---

import { Aside, Steps, Code } from '@astrojs/starlight/components';
import twilioBasicExample from '../../../../../../examples/docs/extensions/twilio-basic.ts?raw';
import twilioServerExample from '../../../../../../examples/realtime-twilio/index.ts?raw';

Twilio は、電話の通話音声の元オーディオを WebSocket サーバーへ送る [Media Streams API](https://www.twilio.com/docs/voice/media-streams) を提供しています。この構成を使って、あなたの [音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents) を Twilio に接続できます。Twilio から届くイベントを Realtime Session に接続するには、`websocket` モードのデフォルトの Realtime Session トランスポートを使用できます。ただし、Web ベースの会話よりも通話では自然にレイテンシーが大きくなるため、適切なオーディオ形式の設定と、割り込みタイミングの調整が必要になります。

セットアップ体験を向上させるために、Twilio への接続、割り込み処理、オーディオ転送を代わりに処理する専用のトランスポートレイヤーを用意しました。

<Aside type="caution">
  このアダプターはまだベータ版です。まれなケースの問題やバグが発生する可能性があります。
  問題は [GitHub issues](https://github.com/openai/openai-agents-js/issues)
  からご報告ください。迅速に修正します。
</Aside>

## セットアップ

<Steps>

1. **Twilio アカウントと Twilio の電話番号を用意します。**

2. **Twilio からのイベントを受信できる WebSocket サーバーをセットアップします。**

   ローカル開発の場合、[`ngrok`](https://ngrok.io/) や
   [Cloudflare Tunnel](https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/)
   などのローカルトンネルの設定が必要です。これにより、ローカルサーバーを Twilio からアクセス可能にします。`TwilioRealtimeTransportLayer`
   を使って Twilio に接続できます。

3. **拡張パッケージをインストールして Twilio アダプターを導入します:**

   ```bash
   npm install @openai/agents-extensions
   ```

4. **アダプターとモデルをインポートして、`RealtimeSession` に接続します:**

   <Code
     lang="typescript"
     code={twilioBasicExample.replace(
       /\n\s+\/\/ @ts-expect-error - this is not defined/g,
       '',
     )}
   />

5. **`RealtimeSession` を Twilio に接続します:**

   ```typescript
   session.connect({ apiKey: 'your-openai-api-key' });
   ```

</Steps>

`RealtimeSession` に期待されるあらゆるイベントや挙動は、ツール呼び出しやガードレールなどを含め、そのまま動作します。`RealtimeSession` を音声エージェントで使う方法については、[音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents) を参照してください。

## ヒントと考慮事項

1. **スピードが最重要です。**

   Twilio から必要なイベントとオーディオをすべて受け取るために、WebSocket 接続の参照を取得したらすぐに
   `TwilioRealtimeTransportLayer` のインスタンスを作成し、その直後に `session.connect()` を呼び出してください。

2. **Twilio の元イベントへアクセスします。**

   Twilio から送信される元イベントにアクセスしたい場合は、`RealtimeSession` インスタンスの
   `transport_event` を監視します。Twilio のすべてのイベントは `twilio_message` という type を持ち、元イベントデータを含む `message` プロパティを持ちます。

3. **デバッグログを確認します。**

   問題が発生して詳細を知りたい場合は、環境変数 `DEBUG=openai-agents*` を使うと Agents SDK のすべてのデバッグログが表示されます。あるいは、Twilio アダプターのデバッグログだけを有効化するには
   `DEBUG=openai-agents:extensions:twilio*` を使用します。

## フルサンプルサーバー

以下は、Twilio からのリクエストを受け取り、それを `RealtimeSession` に転送する WebSocket サーバーのエンドツーエンドのサンプルです。

<Code
  lang="typescript"
  code={twilioServerExample}
  title="Example server using Fastify"
/>
